<!DOCTYPE html>
<html>
<head>
  <title>Geo Tag Cow - {{ cow['cow_id'] }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    #map { height: 90vh; width: 100%; }
    body { font-family: Arial; margin: 0; padding: 0; }
    button { margin: 10px; padding: 10px; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=drawing"></script>
</head>
<body>
  <h2 style="text-align:center;">Draw Safe Zone for Cow ID: {{ cow['cow_id'] }}</h2>
  <div id="map"></div>
  <button onclick="saveFence()">Save Fence</button>

  <script>
    let map, drawingManager, selectedShape;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 12.9716, lng: 77.5946 }, 
        zoom: 13
      });

      drawingManager = new google.maps.drawing.DrawingManager({
        drawingMode: google.maps.drawing.OverlayType.POLYGON,
        drawingControl: true,
        drawingControlOptions: {
          position: google.maps.ControlPosition.TOP_CENTER,
          drawingModes: ["polygon"]
        },
        polygonOptions: { editable: true }
      });

      drawingManager.setMap(map);

      google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
        if (selectedShape) {
          selectedShape.setMap(null);
        }
        selectedShape = event.overlay;
      });
    }

   function saveFence() {
    let coordinates = drawnPolygon.getLatLngs()[0].map(p => [p.lat, p.lng]);

    fetch("/save-fence", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            cow_id: "{{ cow['cow_id'] }}",  
            coordinates: coordinates
        })
    })
    .then(res => res.json())
    .then(data => alert(data.status));
}
    window.onload = initMap;
  </script>
</body>
</html>
