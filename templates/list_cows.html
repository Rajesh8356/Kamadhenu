<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Cows - Kamadhenu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #043c07;
      --secondary: #ffc107;
      --light: #f8f9fa;
      --dark: #343a40;
      --light-green: #e8f5e9;
    }
    
    body {
      background-color: #f5f9f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }
    
    .dashboard-container {
      width: 100%;
      margin: 0;
    }

    .sidebar {
      background: linear-gradient(to bottom, var(--primary), #1b5e20);
      color: white;
      height: 100vh;
      position: fixed;
      width: 260px;
      padding-top: 20px;
      box-shadow: 3px 0 10px rgba(0,0,0,0.1);
      overflow-y: auto;
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    .main-content { 
      margin-left: 250px; 
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    .header {
      background-color: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .welcome-text { 
      color: var(--primary); 
      font-weight: 600; 
    }

    .cow-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      padding: 15px;
      transition: all 0.3s ease;
      position: relative; /* For QR code positioning */
    }

    .cow-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }

    .cow-card img.photo {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
    }

    .cow-details p { 
      margin: 5px 0; 
      font-size: 0.95rem; 
    }

    .btn-sm { 
      margin: 3px; 
    }

    /* QR Code Positioning */
    .qr-box-absolute {
      position: absolute;
      top: 15px;
      right: 15px;
      text-align: center;
      z-index: 10;
    }

    .qr-box-absolute img {
      width: 100px;
      height: 100px;
      border: 2px solid var(--primary);
      border-radius: 6px;
      padding: 2px;
      background: white;
    }

    /* Cattle Type Badges */
    .cattle-type-badge {
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 600;
    }
    
    .badge-cow { background-color: #28a745; color: white; }
    .badge-buffalo { background-color: #007bff; color: white; }
    .badge-bull { background-color: #dc3545; color: white; }
    .badge-male_buffalo { background-color: #6f42c1; color: white; }
    .badge-calf { background-color: #fd7e14; color: white; }

    .logo {
      text-align: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      margin-bottom: 30px;
    }
    
    .nav-item { 
      margin: 10px 0; 
    }

    .nav-link {
      color: rgba(255,255,255,0.8);
      padding: 8px 16px;
      border-radius: 5px;
      margin: 5px 15px;
      transition: all 0.3s;
    }

    .nav-link:hover, .nav-link.active { 
      background-color: rgba(255,255,255,0.1); 
      color: white; 
    }

    .nav-link i { 
      margin-right: 10px; 
      width: 20px; 
      text-align: center; 
    }

    .logout-btn {
      background-color: var(--secondary);
      color: var(--dark);
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .logout-btn:hover { 
      background-color: #e0a800; 
      transform: translateY(-2px); 
    }

    .cow-background {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%232e7d32" fill-opacity="0.05" d="M50,10A40,40 0 1,1 50,90A40,40 0 1,1 50,10z M30,30 Q50,15 70,30 Q65,50 70,70 Q50,85 30,70 Q35,50 30,30 z"></path></svg>');
      background-repeat: repeat;
      background-size: 200px;
    }

    /* Submenu styles */
    .submenu {
      list-style: none;
      padding-left: 30px;
      display: none;
    }
    
    .submenu .nav-link {
      font-size: 14px;
      padding: 6px 14px;
      color: rgba(255,255,255,0.7);
    }
    
    .submenu .nav-link:hover {
      color: #fff;
    }

    /* Mobile menu toggle button */
    .menu-toggle {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1100;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* Overlay for mobile when sidebar is open */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 999;
    }
    
    .overlay.active {
      display: block;
    }

    /* Filter Section */
    .filter-section {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }

    .stats-card {
      background: linear-gradient(135deg, var(--primary), #1b5e20);
      color: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }

    .stats-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .stats-card .number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stats-card .label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .search-highlight {
      background-color: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: bold;
    }

    .no-results {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }

    .no-results i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: #dee2e6;
    }

    /* Edit Button Styles */
    .btn-edit {
      background: linear-gradient(45deg, #17a2b8, #138496);
      color: white;
      border: none;
    }

    .btn-edit:hover {
      background: linear-gradient(45deg, #138496, #117a8b);
      color: white;
      transform: translateY(-1px);
    }

    /* Modal Styles */
    .modal-header {
      background: linear-gradient(to right, var(--primary), #1b5e20);
      color: white;
    }

    .modal-footer {
      background-color: #f8f9fa;
    }

    .form-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--primary);
    }

    .form-section h6 {
      color: var(--primary);
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 8px;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .photo-preview {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #dee2e6;
      margin-bottom: 10px;
    }

    .photo-placeholder-small {
      width: 150px;
      height: 150px;
      border-radius: 8px;
      background: #e9ecef;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      margin-bottom: 10px;
    }

    /* Details Grid */
    .cow-card .details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 20px;
    }

    /* Responsive styles */
    @media (max-width: 992px) {
      .cow-card {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 70%;
        max-width: 250px;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        width: 100%;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .header {
        padding: 15px 15px 15px 50px;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .cow-card img.photo {
        width: 100%;
        height: auto;
        max-width: 300px;
        margin: 0 auto 15px;
        display: block;
      }
      
      .cow-details {
        width: 100%;
      }
      
      .cow-details .btn-group {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 10px;
      }
      
      .btn-sm {
        margin: 5px;
      }

      .stats-card .number {
        font-size: 1.5rem;
      }

      .modal-dialog {
        margin: 20px;
      }

      .qr-box-absolute {
        position: relative;
        top: auto;
        right: auto;
        margin-bottom: 15px;
        text-align: center;
      }
      
      .qr-box-absolute img {
        width: 80px;
        height: 80px;
      }
      
      .cow-card .details-grid {
        grid-template-columns: 1fr;
        gap: 5px;
      }
      
      .cow-card {
        padding: 15px 15px 15px 15px;
      }
    }

    @media (max-width: 576px) {
      .main-content {
        padding: 10px;
      }
      
      .cow-card {
        padding: 10px;
      }
      
      .logo h2 {
        font-size: 1.5rem;
      }

      .filter-section .row > div {
        margin-bottom: 10px;
      }

      .photo-preview, .photo-placeholder-small {
        width: 120px;
        height: 120px;
      }

      .qr-box-absolute img {
        width: 70px;
        height: 70px;
      }
    }
     /* Language Selector Styles - BOTTOM */
    .language-selector {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 10000;
        background: white;
        padding: 10px 15px;
        border-radius: 25px;
        box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
        display: flex;
        gap: 10px;
        border: 2px solid #27ae60;
    }

    .lang-btn {
        padding: 8px 20px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .lang-btn.english {
        background: #007bff;
        color: white;
    }

    .lang-btn.kannada {
        background: #ff9800;
        color: white;
    }

    .lang-btn.active {
        transform: scale(1.05);
        box-shadow: 0 0 0 2px white, 0 0 0 4px currentColor;
    }

    /* Hide Google banner */
    .goog-te-banner-frame { display: none !important; }
    body { top: 0 !important; }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .language-selector {
            bottom: 10px;
            right: 10px;
            padding: 6px 10px;
        }
        
        .lang-btn {
            padding: 5px 10px;
            font-size: 12px;
        }
    }
    /* Completely hide ALL Google Translate elements */
    .goog-te-banner-frame,
    .goog-te-banner,
    .goog-te-banner-wrapper,
    .skiptranslate,
    #goog-gt-tt,
    .goog-te-balloon-frame,
    .goog-tooltip,
    .goog-tooltip:hover,
    .goog-text-highlight {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        height: 0 !important;
        width: 0 !important;
        position: absolute !important;
    }
    
    /* Prevent body shift */
    body {
        top: 0px !important;
        position: static !important;
    }
    
    /* Hide the translation menu if it appears */
    .goog-te-menu-frame {
        display: none !important;
    }
  </style>

</head>
<body class="cow-background">
  <!-- Mobile menu toggle -->
  <button class="menu-toggle" id="menuToggle">
    <i class="fas fa-bars"></i>
  </button>
  
  <!-- Overlay for mobile -->
  <div class="overlay" id="overlay"></div>

  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="logo">
        <h2><i class="fas fa-cow"></i> Kamadhenu</h2>
        <p class="mb-0">Cow Management System</p>
      </div>
      
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="/dashboard">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/add_cow">
            <i class="fas fa-plus-circle"></i> Add New Cow
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/cows">
            <i class="fas fa-list"></i> View My Cows
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/find_cow">
            <i class="fas fa-search"></i> Find Cow
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/milk_yield">
            <i class="fas fa-tint"></i> Milk Yield
          </a>
        </li>
           <li class="nav-item">
                    <a class="nav-link " href="/disease_prediction">
                        <i class="fas fa-stethoscope"></i> Disease Detection
                    </a>
                </li>
        <li class="nav-item">
          <a class="nav-link" href="/book_appointment">
            <i class="fas fa-syringe"></i> Book Appointment
          </a>
        </li>
         <li class="nav-item">
          <a class="nav-link" href="{{ url_for('farmer_treatments') }}">
            <i class="fas fa-syringe"></i> Treatment History
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('add_geotag') }}">
            <i class="fas fa-map-marker-alt"></i> Add Geo Tag
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('analytics') }}">
           <i class="fas fa-chart-bar"></i> Analytics
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="#" onclick="toggleSubmenu(event)">
            <i class="fas fa-chart-line"></i> Market Place <i class="fas fa-caret-down float-end"></i>
          </a>
          <ul class="submenu">
            <li><a class="nav-link" href="/buy_cow"><i class="fas fa-shopping-cart"></i> Buy Cows</a></li>
            <li><a class="nav-link" href="/sell_cow"><i class="fas fa-hand-holding-usd"></i> Sell Cows</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/sold_cows">
            <i class="fas fa-check-circle"></i> Sale History
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Header -->
      <div class="header">
        <div>
          <h2 class="welcome-text">My Cattle Profiles</h2>
          <p class="mb-0 text-muted">Manage and view all your cattle</p>
        </div>
        <a href="{{ url_for('farmer_logout') }}" class="btn btn-danger">Logout</a>
      </div>

      <!-- Statistics and Filters Section -->
      <div class="filter-section">
        <div class="row">
          <div class="col-md-4 col-6">
            <div class="stats-card">
              <div class="number">{{ cows|length }}</div>
              <div class="label">Total Cattle</div>
            </div>
          </div>
          <div class="col-md-4 col-6">
            <div class="stats-card">
              <div class="number">{{ cattle_stats.get('cow', 0) }}</div>
              <div class="label">Cows</div>
            </div>
          </div>
          <div class="col-md-4 col-6">
            <div class="stats-card">
              <div class="number">{{ cattle_stats.get('buffalo', 0) }}</div>
              <div class="label">Buffaloes</div>
            </div>
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-4 col-6">
            <div class="stats-card">
              <div class="number">{{ cattle_stats.get('male_buffalo', 0) }}</div>
              <div class="label">Male Buffaloes</div>
            </div>
          </div>
          <div class="col-md-4 col-6">
            <div class="stats-card">
              <div class="number">{{ cattle_stats.get('bull', 0) }}</div>
              <div class="label">Bulls</div>
            </div>
          </div>
          <div class="col-md-4 col-6">
            <div class="stats-card">
              <div class="number">{{ cattle_stats.get('calf', 0) }}</div>
              <div class="label">Calves</div>
            </div>
          </div>
        </div>
        
        <!-- Search and Filter Controls -->
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="cattleTypeFilter" class="form-label">Filter by Cattle Type:</label>
            <select class="form-select" id="cattleTypeFilter" onchange="filterCattle()">
              <option value="all">All Types</option>
              <option value="cow">Cows</option>
              <option value="buffalo">Buffaloes</option>
              <option value="bull">Bulls</option>
              <option value="male_buffalo">Male Buffaloes</option>
              <option value="calf">Calves</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="searchInput" class="form-label">Search Cattle:</label>
            <div class="input-group">
              <input type="text" class="form-control" id="searchInput" placeholder="Search by ID, breed, color, type..." onkeyup="searchCattle()">
              <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <small class="text-muted">Search by cow ID, breed name, color, or cattle type</small>
          </div>
        </div>

        <!-- Search Results Info -->
        <div class="row mt-2">
          <div class="col-12">
            <div id="searchInfo" class="alert alert-info" style="display: none;">
              <i class="fas fa-info-circle"></i> <span id="searchInfoText"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Cow Cards Section -->
      <div id="cowsContainer">
        {% if cows %}
          {% for cow in cows %}
          <div class="cow-card" 
               data-cattle-type="{{ cow.cattle_type }}" 
               data-cow-id="{{ cow.cow_id.lower() }}"
               data-breed="{{ cow.breed.lower() if cow.breed else '' }}"
               data-color="{{ cow.color.lower() if cow.color else '' }}"
               data-cattle-type-name="{{ cow.cattle_type.lower() }}">
            
            <!-- QR Code in Top-Right Corner -->
            <div class="qr-box-absolute">
              <img src="{{ url_for('static', filename='qrcodes/' ~ cow.cow_id ~ '.png') }}" alt="QR Code">
              <p class="small text-muted mt-1">{{ cow.cow_id }}</p>
            </div>

            <!-- Content Area -->
            <div class="d-flex align-items-start">
              {% if cow.photo %}
              <img src="{{ url_for('static', filename='uploads/cow/' ~ cow.photo) }}" class="photo me-3" alt="Cow Photo">
              {% else %}
              <div class="photo me-3 bg-light d-flex align-items-center justify-content-center" style="width: 200px; height: 150px; border-radius: 8px;">
                <i class="fas fa-cow" style="font-size: 3rem; color: var(--primary);"></i>
              </div>
              {% endif %}

              <div class="cow-details flex-grow-1">
                <div class="d-flex align-items-center mb-2">
                  <h5 style="color: var(--primary); font-weight: bold; margin-right: 10px;">
                    <span class="cow-breed">{{ cow.breed }}</span> (<span class="cow-id">{{ cow.cow_id }}</span>)
                  </h5>
                  <span class="cattle-type-badge badge-{{ cow.cattle_type }}">
                    {% if cow.cattle_type == 'cow' %}Cow
                    {% elif cow.cattle_type == 'buffalo' %}Buffalo
                    {% elif cow.cattle_type == 'bull' %}Bull
                    {% elif cow.cattle_type == 'male_buffalo' %}Male Buffalo
                    {% elif cow.cattle_type == 'calf' %}Calf
                    {% else %}{{ cow.cattle_type|title }}{% endif %}
                  </span>
                </div>
                
                <div class="details-grid mb-3">
                  <p><b>Age:</b> <span class="cow-age">{{ cow.age }}</span> months</p>
                  <p><b>Weight:</b> <span class="cow-weight">{{ cow.weight }}</span> kg</p>
                  <p><b>Color:</b> <span class="cow-color">{{ cow.color }}</span></p>
                  
                  <!-- Milk Yield (only for cows and buffaloes) -->
                  {% if cow.cattle_type in ['cow', 'buffalo'] and cow.milk_yield %}
                  <p><b>Milk Yield:</b> <span class="cow-milk">{{ cow.milk_yield }}</span> L/day</p>
                  {% endif %}
                </div>
                
                <!-- Parent Information (only for calves) -->
                {% if cow.cattle_type == 'calf' %}
                <div class="parent-info mb-3 p-2 bg-light rounded">
                  <small>
                    {% if cow.father_id %}
                    <p class="mb-1"><b>Father:</b> {{ cow.father_id }}</p>
                    {% endif %}
                    {% if cow.mother_id %}
                    <p class="mb-0"><b>Mother:</b> {{ cow.mother_id }}</p>
                    {% endif %}
                  </small>
                </div>
                {% endif %}
                
                <!-- Muzzle ID (if available) -->
                {% if cow.muzzle_id %}
                <p class="mb-2"><small><b>Muzzle ID:</b> {{ cow.muzzle_id }}</small></p>
                {% endif %}

                <!-- Action Buttons -->
                <div class="d-flex flex-wrap">
                  <a href="/cow/{{ cow.cow_id }}" class="btn btn-sm btn-success m-1">
                    <i class="fas fa-eye"></i> View Details
                  </a>
                  <button class="btn btn-sm btn-edit m-1" onclick="openEditModal('{{ cow.cow_id }}')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <form action="/delete_cow/{{ cow.cow_id }}" method="POST" class="m-1">
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this cattle?');">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="card">
            <div class="card-body text-center py-5">
              <div class="cow-icon mb-3">
                <i class="fas fa-cow" style="font-size: 3rem; color: var(--primary);"></i>
              </div>
              <h4 class="text-muted">No Cattle Added Yet</h4>
              <p class="text-muted mb-3">You haven't added any cattle to your farm yet.</p>
              <a href="/add_cow" class="btn btn-primary">
                <i class="fas fa-plus-circle"></i> Add Your First Cattle
              </a>
            </div>
          </div>
        {% endif %}
      </div>

      <!-- No Results Message (hidden by default) -->
      <div id="noResults" class="no-results" style="display: none;">
        <i class="fas fa-search"></i>
        <h4>No cattle found</h4>
        <p>Try adjusting your search or filter criteria</p>
        <button class="btn btn-primary mt-2" onclick="clearSearch()">
          <i class="fas fa-times"></i> Clear Search
        </button>
      </div>

      <!-- Back to Dashboard -->
      <a href="/dashboard" class="btn btn-primary mt-3">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </div>

  <!-- Edit Cattle Modal -->
  <div class="modal fade" id="editCattleModal" tabindex="-1" aria-labelledby="editCattleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editCattleModalLabel">
            <i class="fas fa-edit me-2"></i>Edit Cattle Details
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editCattleForm" enctype="multipart/form-data" action="/update_cow" method="POST">
            <input type="hidden" id="editCowId" name="cow_id">
            
            <!-- Basic Information Section -->
            <div class="form-section">
              <h6><i class="fas fa-info-circle me-2"></i>Basic Information</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editCattleType" class="form-label">Cattle Type *</label>
                  <select class="form-select" id="editCattleType" name="cattle_type" required>
                    <option value="cow">Cow</option>
                    <option value="buffalo">Buffalo</option>
                    <option value="bull">Bull</option>
                    <option value="male_buffalo">Male Buffalo</option>
                    <option value="calf">Calf</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editBreed" class="form-label">Breed *</label>
                  <input type="text" class="form-control" id="editBreed" name="breed" required>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editDateOfBirth" class="form-label">Date of Birth</label>
                  <input type="date" class="form-control" id="editDateOfBirth" name="date_of_birth">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editAge" class="form-label">Age (months) *</label>
                  <input type="number" class="form-control" id="editAge" name="age" min="0" readonly style="background-color: #f8f9fa;">
                  <small class="text-muted">Age is calculated automatically from date of birth</small>
              </div>
              </div>
            </div>

            <!-- Physical Details Section -->
            <div class="form-section">
              <h6><i class="fas fa-weight me-2"></i>Physical Details</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editWeight" class="form-label">Weight (kg) *</label>
                  <input type="number" class="form-control" id="editWeight" name="weight" step="0.1" min="0" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editColor" class="form-label">Color</label>
                  <input type="text" class="form-control" id="editColor" name="color" placeholder="e.g., Black, Brown, White">
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editMilkYield" class="form-label">Milk Yield (L/day)</label>
                  <input type="number" class="form-control" id="editMilkYield" name="milk_yield" step="0.1" min="0">
                  <small class="text-muted">Only for cows and buffaloes</small>
                </div>
              </div>
            </div>

            <!-- Health & Medical Section -->
            <div class="form-section">
              <h6><i class="fas fa-heartbeat me-2"></i>Health & Medical Information</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editHealthRecords" class="form-label">Health Records</label>
                  <textarea class="form-control" id="editHealthRecords" name="health_records" rows="3" placeholder="Any health issues, treatments, etc."></textarea>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editVaccinationHistory" class="form-label">Vaccination History</label>
                  <textarea class="form-control" id="editVaccinationHistory" name="vaccination_history" rows="3" placeholder="Vaccination details and dates"></textarea>
                </div>
              </div>
              <div class="row">
                <div class="col-12 mb-3">
                  <label for="editSpecialNotes" class="form-label">Special Notes</label>
                  <textarea class="form-control" id="editSpecialNotes" name="special_notes" rows="2" placeholder="Any additional notes or observations"></textarea>
                </div>
              </div>
            </div>

            <!-- Parent Information (for calves) -->
            <div class="form-section" id="parentInfoSection" style="display: none;">
              <h6><i class="fas fa-family me-2"></i>Parent Information</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editMotherId" class="form-label">Mother ID</label>
                  <input type="text" class="form-control" id="editMotherId" name="mother_id" placeholder="Mother's Cow ID">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editFatherId" class="form-label">Father ID</label>
                  <input type="text" class="form-control" id="editFatherId" name="father_id" placeholder="Father's Cow ID">
                </div>
              </div>
            </div>

            <!-- Insurance Details Section -->
            <div class="form-section">
              <h6><i class="fas fa-shield-alt me-2"></i>Insurance Details</h6>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="editInsuranceBy" class="form-label">Insurance Company</label>
                  <input type="text" class="form-control" id="editInsuranceBy" name="insurance_by" placeholder="Insurance provider name">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="editInsurancePolicyNumber" class="form-label">Policy Number</label>
                  <input type="text" class="form-control" id="editInsurancePolicyNumber" name="insurance_policy_number" placeholder="Policy number">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="editInsuranceValidUpto" class="form-label">Valid Until</label>
                  <input type="date" class="form-control" id="editInsuranceValidUpto" name="insurance_valid_upto">
                </div>
              </div>
            </div>

            <!-- Photo Upload Section -->
            <div class="form-section">
              <h6><i class="fas fa-camera me-2"></i>Photo</h6>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div id="currentPhotoPreview">
                    <!-- Current photo will be displayed here -->
                  </div>
                </div>
                <div class="col-md-8 mb-3">
                  <label for="editPhoto" class="form-label">Update Photo</label>
                  <input type="file" class="form-control" id="editPhoto" name="photo" accept="image/*">
                  <small class="text-muted">Leave empty to keep current photo</small>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i> Cancel
          </button>
          <button type="submit" form="editCattleForm" class="btn btn-primary">
            <i class="fas fa-save me-1"></i> Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function toggleSubmenu(event) {
      event.preventDefault();
      const submenu = event.target.closest("li").querySelector(".submenu");
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }

    // Toggle mobile sidebar
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const overlay = document.getElementById('overlay');
    
    menuToggle.addEventListener('click', function() {
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
      
      // Change icon based on sidebar state
      const icon = menuToggle.querySelector('i');
      if (sidebar.classList.contains('active')) {
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
      } else {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
      }
    });
    
    // Close sidebar when clicking on overlay
    overlay.addEventListener('click', function() {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      const icon = menuToggle.querySelector('i');
      icon.classList.remove('fa-times');
      icon.classList.add('fa-bars');
    });
    
    // Close sidebar when clicking on a nav link (mobile)
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          const icon = menuToggle.querySelector('i');
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        }
      });
    });

    // Filter and Search Functions
    let currentSearchTerm = '';
    let currentFilter = 'all';

    function filterCattle() {
      currentFilter = document.getElementById('cattleTypeFilter').value;
      applyFilters();
    }

    function searchCattle() {
      currentSearchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
      applyFilters();
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      currentSearchTerm = '';
      applyFilters();
      document.getElementById('searchInput').focus();
    }

    function applyFilters() {
      const cowCards = document.querySelectorAll('.cow-card');
      let visibleCount = 0;
      
      cowCards.forEach(card => {
        const cattleType = card.getAttribute('data-cattle-type');
        const cowId = card.getAttribute('data-cow-id');
        const breed = card.getAttribute('data-breed');
        const color = card.getAttribute('data-color');
        const cattleTypeName = card.getAttribute('data-cattle-type-name');
        
        let typeMatch = currentFilter === 'all' || cattleType === currentFilter;
        let searchMatch = true;
        
        if (currentSearchTerm) {
          searchMatch = cowId.includes(currentSearchTerm) || 
                       breed.includes(currentSearchTerm) || 
                       color.includes(currentSearchTerm) ||
                       cattleTypeName.includes(currentSearchTerm);
        }
        
        if (typeMatch && searchMatch) {
          card.style.display = 'block';
          visibleCount++;
          
          // Highlight search terms
          if (currentSearchTerm) {
            highlightSearchTerms(card, currentSearchTerm);
          } else {
            removeHighlights(card);
          }
        } else {
          card.style.display = 'none';
          removeHighlights(card);
        }
      });
      
      updateSearchInfo(visibleCount);
      toggleNoResultsMessage(visibleCount);
    }

    function highlightSearchTerms(card, searchTerm) {
      const elements = card.querySelectorAll('.cow-id, .cow-breed, .cow-color');
      
      elements.forEach(element => {
        const text = element.textContent;
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        const highlightedText = text.replace(regex, '<span class="search-highlight">$1</span>');
        element.innerHTML = highlightedText;
      });
    }

    function removeHighlights(card) {
      const elements = card.querySelectorAll('.cow-id, .cow-breed, .cow-color');
      
      elements.forEach(element => {
        element.innerHTML = element.textContent;
      });
    }

    function updateSearchInfo(visibleCount) {
      const searchInfo = document.getElementById('searchInfo');
      const searchInfoText = document.getElementById('searchInfoText');
      const totalCows = document.querySelectorAll('.cow-card').length;
      
      if (currentSearchTerm || currentFilter !== 'all') {
        let message = `Showing ${visibleCount} of ${totalCows} cattle`;
        
        if (currentSearchTerm) {
          message += ` for "${currentSearchTerm}"`;
        }
        
        if (currentFilter !== 'all') {
          message += ` (Filtered by: ${document.getElementById('cattleTypeFilter').options[document.getElementById('cattleTypeFilter').selectedIndex].text})`;
        }
        
        searchInfoText.textContent = message;
        searchInfo.style.display = 'block';
      } else {
        searchInfo.style.display = 'none';
      }
    }

    function toggleNoResultsMessage(visibleCount) {
      const noResults = document.getElementById('noResults');
      const cowsContainer = document.getElementById('cowsContainer');
      
      if (visibleCount === 0 && (currentSearchTerm || currentFilter !== 'all')) {
        noResults.style.display = 'block';
        cowsContainer.style.display = 'none';
      } else {
        noResults.style.display = 'none';
        cowsContainer.style.display = 'block';
      }
    }

    // Edit Modal Functions
    // Edit Modal Functions
function openEditModal(cowId) {
    // Fetch cattle data from server
    fetch(`/get_cow_details/${cowId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(cow => {
            // Populate the form with fetched data
            document.getElementById('editCowId').value = cow.cow_id;
            document.getElementById('editCattleType').value = cow.cattle_type || '';
            document.getElementById('editBreed').value = cow.breed || '';
            document.getElementById('editDateOfBirth').value = cow.date_of_birth || '';
            document.getElementById('editAge').value = cow.age || '';
            document.getElementById('editWeight').value = cow.weight || '';
            document.getElementById('editColor').value = cow.color || '';
            document.getElementById('editMilkYield').value = cow.milk_yield || '';
            document.getElementById('editHealthRecords').value = cow.health_records || '';
            document.getElementById('editVaccinationHistory').value = cow.vaccination_history || '';
            document.getElementById('editSpecialNotes').value = cow.special_notes || '';
            document.getElementById('editMotherId').value = cow.mother_id || '';
            document.getElementById('editFatherId').value = cow.father_id || '';
            document.getElementById('editInsuranceBy').value = cow.insurance_by || '';
            document.getElementById('editInsurancePolicyNumber').value = cow.insurance_policy_number || '';
            document.getElementById('editInsuranceValidUpto').value = cow.insurance_valid_upto || '';
            
            // Show/hide parent info section based on cattle type
            const parentSection = document.getElementById('parentInfoSection');
            const milkYieldField = document.getElementById('editMilkYield').closest('.mb-3');
            
            if (cow.cattle_type === 'calf') {
                parentSection.style.display = 'block';
                milkYieldField.style.display = 'none';
            } else if (cow.cattle_type === 'cow' || cow.cattle_type === 'buffalo') {
                parentSection.style.display = 'none';
                milkYieldField.style.display = 'block';
            } else {
                parentSection.style.display = 'none';
                milkYieldField.style.display = 'none';
            }
            
            // Display current photo
            const photoPreview = document.getElementById('currentPhotoPreview');
            if (cow.photo) {
                photoPreview.innerHTML = `<img src="/static/uploads/cow/${cow.photo}" class="photo-preview" alt="Current Photo">`;
            } else {
                photoPreview.innerHTML = `
                    <div class="photo-placeholder-small">
                        <i class="fas fa-cow" style="font-size: 2rem;"></i>
                        <div class="small mt-1">No Photo</div>
                    </div>
                `;
            }
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('editCattleModal'));
            modal.show();
        })
        .catch(error => {
            console.error('Error fetching cow details:', error);
            alert('Error loading cattle details. Please try again.');
        });
}
    // Initialize filters and search on page load
    document.addEventListener('DOMContentLoaded', function() {
      applyFilters();
      
      // Add keyboard shortcut for clearing search (Esc key)
      document.getElementById('searchInput').addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          clearSearch();
        }
      });
// Add this to your JavaScript to update age when date of birth changes
document.getElementById('editDateOfBirth').addEventListener('change', function() {
    if (this.value) {
        const dob = new Date(this.value);
        const today = new Date();
        let ageInMonths = (today.getFullYear() - dob.getFullYear()) * 12 + (today.getMonth() - dob.getMonth());
        
        // Adjust if the day of month hasn't occurred yet
        if (today.getDate() < dob.getDate()) {
            ageInMonths--;
        }
        
        document.getElementById('editAge').value = Math.max(0, ageInMonths);
    } else {
        document.getElementById('editAge').value = '';
    }
});
      // Toggle parent info section based on cattle type selection
      document.getElementById('editCattleType').addEventListener('change', function() {
        const parentSection = document.getElementById('parentInfoSection');
        const milkYieldField = document.getElementById('editMilkYield').closest('.mb-3');
        
        if (this.value === 'calf') {
          parentSection.style.display = 'block';
          milkYieldField.style.display = 'none';
        } else if (this.value === 'cow' || this.value === 'buffalo') {
          parentSection.style.display = 'none';
          milkYieldField.style.display = 'block';
        } else {
          parentSection.style.display = 'none';
          milkYieldField.style.display = 'none';
        }
      });
    });
  </script>
  <script>
    // Language translation functions
    function googleTranslateElementInit() {
        if (typeof google !== 'undefined' && google.translate) {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,kn',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
            
            const savedLang = localStorage.getItem('selectedLanguage');
            if(savedLang === 'kn') {
                setTimeout(() => applyKannada(), 1000);
            }
        }
    }

    window.onload = function() {
        if (typeof google !== 'undefined' && google.translate) {
            googleTranslateElementInit();
        } else {
            var script = document.createElement('script');
            script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
            document.body.appendChild(script);
        }
        
        const savedLang = localStorage.getItem('selectedLanguage');
        if(savedLang === 'kn') {
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.lang-btn.kannada').classList.add('active');
            setTimeout(() => applyKannada(), 2000);
        }
    };

    function applyKannada() {
        var iframe = document.querySelector('.goog-te-menu-frame');
        if(iframe && iframe.contentDocument) {
            var select = iframe.contentDocument.querySelector('.goog-te-menu2-select');
            if(select) {
                select.value = 'kn';
                select.dispatchEvent(new Event('change'));
                return true;
            }
        }
        
        var elements = document.querySelectorAll('.goog-te-menu2-select');
        if(elements.length > 0) {
            elements[0].value = 'kn';
            elements[0].dispatchEvent(new Event('change'));
            return true;
        }
        
        return false;
    }

    function setLanguage(lang) {
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        localStorage.setItem('selectedLanguage', lang);
        
        if(lang === 'kn') {
            window.location.hash = '#googtrans(kn)';
            if(applyKannada()) {
                console.log('ಭಾಷೆ ಕನ್ನಡಕ್ಕೆ ಬದಲಾಯಿಸಲಾಗಿದೆ');
            } else {
                setTimeout(() => location.reload(), 500);
            }
        } else {
            window.location.hash = '#googtrans(en)';
            var iframe = document.querySelector('.goog-te-menu-frame');
            if(iframe && iframe.contentDocument) {
                var select = iframe.contentDocument.querySelector('.goog-te-menu2-select');
                if(select) {
                    select.value = 'en';
                    select.dispatchEvent(new Event('change'));
                    console.log('Language changed to English');
                    return;
                }
            }
            setTimeout(() => location.reload(), 500);
        }
    }
</script>
</body>
</html>